// Generated by CoffeeScript 1.6.2
(function() {
  var animateCircleGrowth, animateMarker, buildLabel, center, createEmptyTimeline, createMoment, createMomentAtTimeline, createMomentDot, createMoments, createTimelineContainer, createTimelineWithMoments, drawInMarkers, drawTimelineOriginCircle, drawTimelineSpine, getContainer, getNextId, getTestData, getUtils, insertMomentsIntoTimeline, makeCircle, makeMarker, monthNumToName, parseDate, printCurrentContainerData, produceIntervals, runTests, setContainerData, shootMarkerByDate;

  createEmptyTimeline = function(startDate, endDate, interval, jQueryObject) {};

  createTimelineWithMoments = function(startDate, endDate, interval, jQueryObject, moments) {};

  createMomentAtTimeline = function(moment, jQueryTimeline) {};

  insertMomentsIntoTimeline = function(moments, jQueryTimeline) {};

  setContainerData = function(container, start, end, markerLeftBuffer) {
    return container.data({
      utils: {
        startDate: start,
        endDate: end,
        markerLeftBuffer: markerLeftBuffer,
        spineWidth: this.spineWidth != null ? 100 : void 0,
        dateToMarkerNo: function(d) {
          return Math.floor((d - this.startDate) / (1000 * 60 * 60 * 24));
        },
        noOfIntervals: function() {
          return 1 + this.dateToMarkerNo(this.endDate);
        },
        dateToMarkerLeft: function(d) {
          return (this.markerLeftBuffer + this.pctPerInterval() * (this.dateToMarkerNo(d))) + '%';
        },
        pctPerInterval: function() {
          return (100 - this.markerLeftBuffer) / (this.noOfIntervals() - 1);
        },
        toString: function() {
          return "Start : " + this.startDate + " 				\nEnd : " + this.endDate + "  				\nMarkers left buffer : " + this.markerLeftBuffer + " 				\nNo Of Intervals : " + (this.noOfIntervals()) + "  				\nPercent per Interval : " + (this.pctPerInterval().toFixed(3));
        }
      }
    });
  };

  produceIntervals = function(start, end, interval) {
    var result, setPriority, _i, _len;
    start = parseDate(start);
    end = parseDate(end);
    result = [];
    while (start <= end) {
      result.push({
        date: start.getDate(),
        day: start.getDay(),
        month: start.getMonth(),
        year: 1900 + start.getYear(),
        toString: function() {
          return this.date + '/' + this.month + '/' + this.year + ' day is ' + this.day;
        }
      });
      start.setDate(start.getDate() + 1);
    }
    setPriority = function(interval) {
      if (interval['date'] === 1) {
        return interval['priority'] = 3;
      } else if (interval['day'] === 1) {
        return interval['priority'] = 2;
      } else {
        return interval['priority'] = 1;
      }
    };
    for (_i = 0, _len = result.length; _i < _len; _i++) {
      interval = result[_i];
      setPriority(interval);
    }
    console.log('No of Intervals, length of array = ' + result.length);
    return result;
  };

  getContainer = function(spine) {
    return spine.parent();
  };

  getUtils = function(container) {
    if (container.hasClass('spine')) {
      return container.parent().data('utils');
    } else {
      return container.data('utils');
    }
  };

  getNextId = function() {
    return 'timeline_' + $('.timeline').length + 1;
  };

  parseDate = function(input) {
    var parts;
    parts = input.match(/(\d+)/g);
    return new Date(parts[0], parts[1] - 1, parts[2]);
  };

  monthNumToName = function(m) {
    return "Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Aug,Nov,Dec".split(',')[m];
  };

  createTimelineContainer = function(userContainer) {
    var timelineContainer;
    userContainer.append(timelineContainer = $(document.createElement('div')));
    timelineContainer.attr({
      'id': getNextId(),
      'class': 'timelineContainer'
    }).css({
      'position': 'absolute',
      'height': '150px',
      'width': '100%',
      'backgroundColor': 'white'
    });
    return timelineContainer;
  };

  makeCircle = function(r, c) {
    var circle;
    return center(circle = $(document.createElement('div')).css({
      background: c,
      height: r + 'px',
      width: r + 'px',
      '-moz-border-radius': r + 'px',
      '-webkit-border-radius': r + 'px',
      position: 'absolute'
    }));
  };

  center = function(c) {
    return c.css({
      'margin-top': -c.height() / 2 + 'px',
      'margin-left': -c.width() / 2 + 'px'
    });
  };

  animateCircleGrowth = function(c, rGoal, speed) {
    return c.animate({
      'height': rGoal + 'px',
      'width': rGoal + 'px',
      '-moz-border-radius': rGoal + 'px',
      '-webkit-border-radius': rGoal + 'px',
      'margin-top': -rGoal / 2 + 'px',
      'margin-left': -rGoal / 2 + 'px'
    }, {
      duration: speed
    });
  };

  drawTimelineSpine = function(timelineContainer) {
    var leftBuffer, rightBuffer, tlSpine;
    leftBuffer = 7;
    rightBuffer = 3;
    tlSpine = $(document.createElement('div')).data({
      'leftBuffer': leftBuffer,
      'rightBuffer': rightBuffer
    });
    timelineContainer.append(tlSpine);
    tlSpine.attr({
      'class': 'spine'
    }).css({
      'position': 'absolute',
      'width': '0%',
      'height': '1px',
      'margin-top': '50%',
      'margin-left': leftBuffer + '%',
      'margin-right': rightBuffer + '%',
      'backgroundColor': 'black'
    }).animate({
      width: 100 - (rightBuffer + leftBuffer) + '%'
    }, {
      duration: 1000,
      complete: function() {
        return tlSpine.find('.intMarker').delay(800).fadeIn(600);
      }
    });
    getUtils(timelineContainer).spineWidth = 100 - (rightBuffer + leftBuffer);
    return tlSpine;
  };

  drawTimelineOriginCircle = function(spine) {
    var container;
    container = getContainer(spine);
    container.append(makeCircle(12, 'black').addClass('originCircle').css({
      'opacity': 0,
      'top': '50%',
      'left': spine.data('leftBuffer') + '%'
    }));
    return container.find('.originCircle').animate({
      'opacity': 1
    }, {
      duration: '300',
      easing: 'easeInBounce'
    });
  };

  makeMarker = function(properties) {
    var h, w;
    h = properties['h'];
    w = properties['w'];
    return $(document.createElement('div')).css({
      position: 'absolute',
      top: 0,
      marginTop: 0,
      'margin-left': -w / 2,
      height: 0,
      width: w,
      backgroundColor: properties['c']
    }).data('finalHeight', h);
  };

  animateMarker = function(m) {
    var finalHeight;
    finalHeight = m.data('finalHeight');
    return m.delay(1200).animate({
      height: finalHeight,
      marginTop: -finalHeight / 2
    }, {
      duration: 300
    });
  };

  buildLabel = function(int) {
    var lbl, txt;
    lbl = $(document.createElement('div')).css({
      marginTop: -14,
      width: 40,
      marginLeft: -20,
      textAlign: 'center',
      height: 'auto',
      fontFamily: 'Arial',
      fontSize: '7px',
      position: 'absolute'
    }).addClass('intMarker');
    txt = '';
    switch (int.priority) {
      case 3:
        txt = monthNumToName(int.month);
        lbl.css({
          marginTop: -20,
          fontSize: 9,
          fontWeight: 'bold'
        });
        break;
      case 2:
        txt = 'Mon ' + int.date;
        break;
      case 1:
        return null;
    }
    return lbl.text(txt);
  };

  drawInMarkers = function(spine, intervals) {
    var assignCSS, buffer, i, int, lbl, mrk, pctPerInterval, pos, today, utils, _i, _len, _results;
    today = new Date();
    console.log(today.getMonth());
    assignCSS = function(int) {
      var r;
      switch (int.priority) {
        case 3:
          r = {
            w: 3,
            h: 19,
            c: 'black'
          };
          break;
        case 2:
          r = {
            w: 2,
            h: 11,
            c: 'black'
          };
          break;
        case 1:
          r = {
            w: 1,
            h: 5,
            c: 'black'
          };
      }
      if ((int.date === today.getDate()) && (int.month === today.getMonth())) {
        r.c = 'blue';
      }
      return r;
    };
    utils = getUtils(getContainer(spine));
    buffer = utils.markerLeftBuffer;
    pctPerInterval = utils.pctPerInterval();
    _results = [];
    for (i = _i = 0, _len = intervals.length; _i < _len; i = ++_i) {
      int = intervals[i];
      pos = 3 + i * pctPerInterval + '%';
      (mrk = makeMarker(assignCSS(int))).css({
        left: pos
      });
      spine.append(mrk);
      animateMarker(mrk);
      lbl = buildLabel(int);
      if (lbl != null) {
        spine.append(lbl.css('left', pos));
        _results.push(lbl.hide());
      } else {
        _results.push(void 0);
      }
    }
    return _results;
  };

  createMomentDot = function(date, spine) {
    return spine.append(makeCircle(5, 'red').delay(1400).css('left', 0).animate({
      left: getUtils(spine).dateToMarkerLeft(parseDate(date))
    }, {
      duration: 400
    }));
  };

  createMoment = function(m, spine) {
    var utils;
    utils = getUtils(spine);
    return createMomentDot(m.start, spine);
  };

  createMoments = function(moments, spine) {
    var m, _i, _len, _results;
    _results = [];
    for (_i = 0, _len = moments.length; _i < _len; _i++) {
      m = moments[_i];
      _results.push(createMoment(m, spine));
    }
    return _results;
  };

  printCurrentContainerData = function(container) {
    return console.log(getUtils(container).toString());
  };

  shootMarkerByDate = function(d, container, utils) {
    var spine;
    spine = container.find('.spine').eq(0);
    return $(document.createElement('div')).css({
      left: utils.dateToMarkerLeft(parseDate(d)),
      position: 'absolute',
      backgroundColor: 'black',
      height: 30,
      width: 1,
      marginTop: -15
    }).appendTo(spine);
  };

  getTestData = function() {
    return [
      {
        id: '2',
        type: 'TUT',
        name: 'Tutorial sheet 1 - recap and basic objects',
        start: '2013-01-14',
        end: '2013-01-21'
      }, {
        id: '4',
        type: 'TUT',
        name: 'Tutorial sheet 3 - abstract classes and interfaces',
        start: '2013-01-28',
        end: '2013-02-12'
      }, {
        id: '6',
        type: 'TUT',
        name: 'Tutorial sheet 5 - exceptions and miscellaneous',
        start: '2013-02-11',
        end: '2013-02-18'
      }, {
        id: '8',
        type: 'TUT',
        name: 'Live demo code from Part 1 of the course ',
        start: '2013-02-22',
        end: '2013-03-06'
      }, {
        id: '18',
        type: 'TUT',
        name: 'Heaps and AVL trees',
        start: '2013-03-10',
        end: '2013-03-17'
      }, {
        id: '17',
        type: 'TUT',
        name: 'Tutorial 3 - Trees and BSTs',
        start: '2013-03-03',
        end: '2013-03-10'
      }, {
        id: '19',
        type: 'OT',
        name: 'Exercise 19',
        start: '2013-03-12',
        end: '2013-03-17'
      }
    ];
  };

  runTests = function(container, spine) {
    var utils;
    utils = getUtils(container);
    console.log('Printing current container information...\n');
    printCurrentContainerData(container);
    console.log('Test selecting date 2013-03-01...');
    return createMoments(getTestData(), spine, utils);
  };

  $(function() {
    var container, intervals, spine, testEnd, testStart, _ref;
    _ref = ['2013-01-07', '2013-03-27'], testStart = _ref[0], testEnd = _ref[1];
    container = createTimelineContainer($('#container'));
    setContainerData(container, parseDate(testStart), parseDate(testEnd), 3);
    intervals = produceIntervals(testStart, testEnd, 'day');
    drawInMarkers((spine = drawTimelineSpine(container)), intervals);
    drawTimelineOriginCircle(spine);
    return runTests(container, spine);
  });

}).call(this);
